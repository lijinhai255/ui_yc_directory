version: 1
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            - echo "=== Debug: Current directory and structure ==="
            - pwd
            - ls -la
            - echo "=== Installing pnpm ==="
            - npm install -g pnpm
            - echo "=== Installing dependencies ==="
            - pnpm install --frozen-lockfile
            - echo "=== Checking package.json scripts ==="
            - cat package.json | grep -A 10 "scripts"
        build:
          commands:
            - echo "=== Building Storybook ==="
            - pnpm run build-storybook
            - echo "=== Checking build output ==="
            - ls -la
            - if [ -d "storybook-static" ]; then echo "storybook-static found"; ls -la storybook-static; else echo "storybook-static not found, checking other directories"; find . -name "*storybook*" -type d; fi
      artifacts:
        baseDirectory: packages/ui/storybook-static
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - /root/.pnpm-store