version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Listing repository structure..."
        - ls -la
        - echo "Checking for packages directory..."
        - ls -la packages || echo "No packages directory found"
        - echo "Finding all package.json files..."
        - find . -name "package.json" -type f
        - npm install -g pnpm
        - echo "Installing dependencies..."
        - pnpm install
    build:
      commands:
        - echo "Building Storybook..."
        - if [ -d "packages/ui" ]; then
            echo "Building from packages/ui directory...";
            cd packages/ui && pnpm run build-storybook;
          elif [ -f "package.json" ]; then
            echo "Building from root directory...";
            pnpm run build-storybook;
          else
            echo "No package.json found, cannot build";
            exit 1;
          fi
        - echo "Build completed, listing output directories..."
        - find . -name "storybook-static" -type d
  artifacts:
    baseDirectory: packages/ui/storybook-static
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - packages/*/node_modules/**/*
      - /root/.pnpm-store